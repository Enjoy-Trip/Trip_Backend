<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.trip.plan.mapper.PlanMapper">
	<resultMap type="PlanDto" id="planDtoSimple">
		<result column="plan_no" property="planNo" />
		<result column="plan_title" property="planTitle" />
		<result column="plan_time" property="planTime" />
		<association property="boardUser" javaType="UserDto">
			<result column="user_no" property="userNo" />
			<result column="user_id" property="userId" />
			<result column="user_name" property="userName" />
			<result column="user_profile" property="userProfile" />
		</association>
	</resultMap>

	<resultMap type="PlanDto" id="planDtoDetail">
		<result column="plan_no" property="planNo" />
		<result column="plan_title" property="planTitle" />
		<result column="plan_time" property="planTime" />
		<result column="plan_content" property="planContent" />
		<result column="plan_start_date" property="planStartDate" />
		<result column="plan_end_date" property="planEndDate" />
		<association property="planUser" javaType="UserDto">
			<result column="user_no" property="userNo" />
			<result column="user_id" property="userId" />
			<result column="user_name" property="userName" />
			<result column="user_profile" property="userProfile" />
		</association>
		<collection property="planPlaces"
			column="{planNo = plan_no}" select="planList" javaType="List"
			ofType="PlanPlaceDto" />
	</resultMap>

	<resultMap type="PlanPlaceDto" id="placeList">
		<result column="contentid" property="contentid" />
		<result column="plan_day" property="planDay" />
	</resultMap>
	
	<select id="planList" parameterType="int" resultMap="planDtoSimple">
		select *
		from plan
		where user_no = #{userNo};
	</select>

	<select id="planDetail" parameterType="int" resultMap="planDtoDetail">
		select 
			user_no, 
			plan.plan_no, 
			plan_start_date,
			plan_end_date, 
			plan_time,
			plan_content, 
			plan_title
		from 
			plan inner join plan_detail
		on plan.plan_no = plan_detail.plan_no
		where
			plan.plan_no = 1;
	</select>

	<insert id="planAdd" parameterType="planDto"
		useGeneratedKeys="true" keyProperty="planNo">
		insert into
		plan (user_no,
		plan_title, plan_time)
		values
		(#{planUser.userNo}, #{planTitle}, #{planTime});
	</insert>

	<insert id="planDetailAdd" parameterType="planDto">
		insert into
		plan_detail
		(plan_no, plan_start_date, plan_end_date, plan_content)
		values
		(#{planNo}, #{planStartDate}, #{planEndDate}, #{planContent})
	</insert>

	<delete id="planDelete" parameterType="int">
		delete from
		plan_detail
		where plan_no = #{planNo};

		delete from
		plan
		where plan_no = #{planNo};
	</delete>

	<update id="planModify" parameterType="planDto">
		update plan_detail
		set
		plan_start_date = #{planStartDate},
		plan_end_date = #{planEndDate},
		plan_content = #{planContent}
		where plan_no = #{planNo};

		update plan
		set
		plan_title = #{planTitle},
		plan_time = #{planTime}
		where plan_no =
		#{planNo};
	</update>
</mapper>